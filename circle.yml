general:
  build_dir: Ambassador

machine:
  timezone:
    America/Detroit
  xcode:
    version: "7.0"

  environment:
    BUILD_SETTINGS: build-settings.txt

checkout:
  post:
    - git submodule sync
    - git submodule update --init
dependencies:
  pre:
    - sudo gem install cocoapods xcpretty obcd slather -N
test:
  override:
        - xctool
          -reporter pretty
          -reporter junit:$CIRCLE_TEST_REPORTS/xcode/results.xml
          -reporter plain:$CIRCLE_ARTIFACTS/xctool.log
          CODE_SIGNING_REQUIRED=NO
          CODE_SIGN_IDENTITY=
          PROVISIONING_PROFILE=
          GCC_INSTRUMENT_PROGRAM_FLOW_ARCS=YES
          GCC_GENERATE_TEST_COVERAGE_FILES=YES
          -destination 'platform=iOS Simulator,name=iPhone 6,OS=latest'
          -sdk iphonesimulator
          -project 'Ambassador.xcodeproj'
          -scheme 'TestApplication'
          build build-tests run-tests

  post:
        - bundle exec slather coverage --output-directory $CIRCLE_ARTIFACTS/coverage_reports/
