general:
  build_dir: Ambassador
machine:
  xcode:
    version: "7.0"
checkout:
  post:
    - git submodule sync
    - git submodule update
dependencies:
  pre:
    - sudo gem install cocoapods xcpretty obcd slather -N
test:
  override:
    - set -o pipefail &&
     xcodebuild -project Ambassador.xcodeproj
      -sdk iphonesimulator
       -destination 'platform=iOS Simulator,OS=9.0,name=iPhone 6'
       -configuration Debug
       -scheme TestApplication
       VALID_ARCHS=x86_64
       clean build test | tee $CIRCLE_ARTIFACTS/xcode_raw.log |
      xcpretty --color --report junit --output $CIRCLE_TEST_REPORTS/xcode/results.xml
      - mkdir $CIRCLE_ARTIFACTS/unit-test-results
      - mv xcode/results.xml $CIRCLE_ARTIFACTS/unit-test-results
  post:
    - slather coverage Ambassador.xcodeproj

    - set -o pipefail &&
     xcodebuild -project Ambassador.xcodeproj
      -sdk iphonesimulator
       -destination 'platform=iOS Simulator,OS=9.0,name=iPhone 6'
       -configuration Debug
       -scheme AmbassadorUITests
       VALID_ARCHS=x86_64
       clean build test | tee $CIRCLE_ARTIFACTS/xcode_raw.log |
      xcpretty --color --report junit --output $CIRCLE_TEST_REPORTS/xcode/results.xml
      - mkdir $CIRCLE_ARTIFACTS/ui-test-results
      - mv xcode/results.xml $CIRCLE_ARTIFACTS/ui-test-results
