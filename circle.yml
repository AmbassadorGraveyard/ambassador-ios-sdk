general:
  build_dir: Ambassador

machine:
  timezone:
    America/Detroit
  xcode:
    version: "7.0"

  environment:
    BUILD_SETTINGS: build-settings.txt
    PROJECT_TEMP_ROOT: $(grep -m1 PROJECT_TEMP_ROOT ${BUILD_SETTINGS} | cut -d= -f2 | xargs)
    PROFDATA: $(find ${PROJECT_TEMP_ROOT} -name "Coverage.profdata")
    BINARY: $(find ${PROJECT_TEMP_ROOT} -path "*TestApplication.app/TestApplication")

checkout:
  post:
    - git submodule sync
    - git submodule update --init
dependencies:
  pre:
    - sudo gem install cocoapods xcpretty obcd slather -N
test:
  override:
    - xcodebuild
        -project 'Ambassador.xcodeproj'
        -scheme "TestApplication"
        -sdk iphonesimulator -destination 'platform=iOS Simulator,OS=9.0,name=iPhone 6'
        -configuration 'Debug'
        -enableCodeCoverage YES
        clean test



    - xcodebuild
       -project 'Ambassador.xcodeproj'
       -scheme "TestApplication"
       -sdk iphonesimulator
       -configuration 'Debug'
       -showBuildSettings > ${BUILD_SETTINGS}
       echo ${BUILD_SETTINGS}
    - xcrun llvm-cov show -instr-profile ${PROFDATA} ${BINARY}

  post:

    - bundle exec slather coverage -s Ambassador.xcodeproj
