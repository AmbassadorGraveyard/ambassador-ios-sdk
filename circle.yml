general:
  build_dir: Ambassador
machine:
  xcode:
    version: "7.2"
checkout:
  post:
    - git submodule sync
    - git submodule update
dependencies:
  pre:
    - pod install
    - gem install rainforest-cli
test:
  override:
    - bash secrets.sh
    - set -o pipefail &&
     xcodebuild archive -workspace Ambassador.xcworkspace
      -scheme DemoApp
      -archivePath Ambassador.xcarchive
      CODE_SIGNING_REQUIRED=NO
      CODE_SIGN_IDENTITY="iOS Developer"
      PROVISIONING_PROFILE= "Ambassador SDK Application"
  post:
    - bundle exec slather coverage Ambassador.xcodeproj

    - set -o pipefail &&
     xcodebuild -workspace Ambassador.xcworkspace
      -sdk iphonesimulator
       -destination 'platform=iOS Simulator,OS=latest,name=iPhone 6'
       -scheme AmbassadorUITests
       -configuration Debug
       clean build test | tee $CIRCLE_ARTIFACTS/xcode_raw.log |
      xcpretty --color --report junit --output $CIRCLE_TEST_REPORTS/ui-test-results/results.xml

   # - ./rainforest.sh
